webpackJsonp([2],{177:function(t,e,a){var i=a(180);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(164).default)("6e54e067",i,!0,{})},178:function(t,e,a){"use strict";var i={name:"Loading",data:function(){return{height:100,opacity:1,display:"block"}},methods:{finished:function(){var t=void 0,e=0,a=this;t=setInterval(function(){a.height-=10,a.opacity-=.1,10===++e&&(clearInterval(t),a.display="none")},30)},start:function(){this.height=100,this.opacity=1,this.display="block"}}},n=(a(179),a(39)),o=Object(n.a)(i,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"loading",style:{margin:this.height+"px auto",opacity:this.opacity,display:this.display}},[e("span"),e("span"),e("span"),e("span"),e("span")])},[],!1,null,"d24a182a",null);o.options.__file="Loading.vue";e.a=o.exports},179:function(t,e,a){"use strict";var i=a(177);a.n(i).a},180:function(t,e,a){(t.exports=a(163)(!1)).push([t.i,".loading[data-v-d24a182a]{width:80px;height:40px}.loading span[data-v-d24a182a]{display:inline-block;width:8px;height:100%;border-radius:4px;background:#90ee90;-webkit-animation:load-data-v-d24a182a 1s ease infinite}@-webkit-keyframes load-data-v-d24a182a{0%,to{height:40px;background:#90ee90}50%{height:70px;margin:-15px 0;background:#add8e6}}.loading span[data-v-d24a182a]:nth-child(2){-webkit-animation-delay:.2s}.loading span[data-v-d24a182a]:nth-child(3){-webkit-animation-delay:.4s}.loading span[data-v-d24a182a]:nth-child(4){-webkit-animation-delay:.6s}.loading span[data-v-d24a182a]:nth-child(5){-webkit-animation-delay:.8s}",""])},181:function(t,e,a){var i=a(184);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(164).default)("322fdd72",i,!0,{})},182:function(t,e,a){"use strict";var i={name:"source_tab",components:{loading:a(178).a},data:function(){var t={temp_type:"",loading:!0,list:[],totalNum:1,currentPage:1,groupIndex:null,group_list:this.groupList};switch(console.log(this.tab_type),this.tab_type){case 0:t.perPage=8,t.accept="image/gif, image/jpeg, image/png, image/jpg",t.acceptType="image/*";break;case 1:t.perPage=10,t.accept="audio/basic, audio/midi, audio/x-mid, audio/x-midi, audio/mpeg3, audio/mp3, audio/x-mpeg-3, audio/ogg",t.acceptType="audio/*";break;case 2:t.perPage=10,t.accept="video/ogg, video/mp4, video/webm",t.acceptType="video/*"}return t},props:{tab_type:{type:Number,required:!0,default:0},is_components:{type:Boolean,default:!1},lastIndex:{type:Number},quill:{type:Object},groupList:{required:!0,type:Array}},methods:{getList:function(t){var e=this,a=void 0;switch(e.loading=!0,this.currentPage=t,this.tab_type){case 0:a="/api/admin/source/image/";break;case 1:a="/api/admin/source/media/";break;case 2:a="/api/admin/source/video/"}this.axios.get(a+t+(null!==this.groupIndex?"?type="+this.group_list[this.groupIndex]._id:"")).then(function(t){"0000"===t.data.code?(e.totalNum=t.data.data.totalNum,e.list=t.data.data.list,e.loading=!1,e.$refs.load.finished()):console.error(t)}).catch(function(t){console.error(t)})},add_source:function(t){var e=this,a=void 0,i=void 0,n=void 0,o=void 0,s=t.target.files[0],r=s.type,d=s.size;switch(this.tab_type){case 0:a="图片",i=3145728,n="3M",o="/api/admin/article/upload/image";break;case 1:a="音频",i=6291456,n="6M",o="/api/admin/article/upload/media";break;case 2:a="视频",i=52428800,n="50M",o="/api/admin/article/upload/video"}if(-1===this.accept.indexOf(r))return e.$eventHub.$emit("alert",{type:"warning",message:"请选择我们支持的"+a+"格式!"});if(d>i)return e.$eventHub.$emit("alert",{type:"warning",message:"请选择"+n+"以内的"+a+"!"});var c=new FormData;c.append("file",s,s.name),this.axios.post(o,c,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){e.getList(e.currentPage)}).catch(function(t){return e.$eventHub.$emit("alert",{type:"warning",message:"上传"+a+"出错!"})})},triggerUpload:function(){document.getElementById("upload").click()},handleOk:function(t){t.preventDefault(),this.temp_type?this.handleSubmit():alert("Please enter your name")},handleSubmit:function(){var t=this,e=this;this.axios.post("/api/admin/source/type/new",{name:this.temp_type}).then(function(a){e.group_list=a.data.data,t.$emit("update",e.group_list),console.log(a),e.clearName(),e.$refs.modalForGroup.hide()}).catch(function(t){return e.$eventHub.$emit("alert",{type:"warning",message:"获取分组列表出错!"})})},clearName:function(){this.temp_type=""},deleteSource:function(t){var e,a=this;e=this.list[t],this.axios.post("/api/admin/source/delete",{_id:e._id}).then(function(t){a.getList(a.currentPage)}).catch(function(t){return a.$eventHub.$emit("alert",{type:"warning",message:"删除资源出错!"})})},setSource:function(t,e){var a,i=this;a=this.list[t],this.axios.post("/api/admin/source/set",{_id:a._id,type:e}).then(function(t){i.getList(i.currentPage)}).catch(function(t){return i.$eventHub.$emit("alert",{type:"warning",message:"删除资源出错!"})})},selectGroup:function(t){this.groupIndex=t,this.getList(1)},resetGroup:function(){this.groupIndex=null,this.getList(1)},deleteGroup:function(t){var e=this,a=this;this.axios.post("/api/admin/source/type/delete",{_id:t}).then(function(t){if("0000"!==t.data.code)return a.$eventHub.$emit("alert",{type:"warning",message:t.data.msgCN});a.group_list=t.data.data,e.$emit("update",a.group_list),a.groupIndex=null,a.getList(a.currentPage)}).catch(function(t){return a.$eventHub.$emit("alert",{type:"warning",message:"删除分组出错!"})})},insert:function(t){var e=void 0;if(this.is_components&&this.quill){switch(this.tab_type){case 0:e="image";break;case 1:e="audio";break;case 2:e="video"}this.quill.insertEmbed(this.lastIndex,e,this.list[t].url),this.quill.update(),this.quill.setSelection(this.lastIndex+1),this.$emit("hide")}}},beforeMount:function(){this.getList(1)}},n=(a(183),a(39)),o=Object(n.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",[a("b-row",{staticClass:"flex_space_between"},[a("div",[a("b-dropdown",{staticClass:"m-md-2",attrs:{size:"sm",id:"ddown1",text:null==t.groupIndex?"选择分组":t.group_list[t.groupIndex].name}},[t._l(t.group_list,function(e,i){return a("b-dropdown-item",{key:i,on:{click:function(e){t.selectGroup(i)}}},[t._v(t._s(e.name))])}),a("b-dropdown-divider"),a("b-dropdown-item",{directives:[{name:"b-modal",rawName:"v-b-modal.modalForGroup",modifiers:{modalForGroup:!0}}]},[t._v("新建分组")])],2),null!==t.groupIndex?a("span",[a("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"secondary"},on:{click:function(e){t.resetGroup()}}},[a("i",{staticClass:"fa fa-times"})]),a("b-button",{attrs:{size:"sm",variant:"secondary"},on:{click:function(e){t.deleteGroup(t.group_list[t.groupIndex]._id)}}},[a("i",{staticClass:"fa fa-trash-o"})])],1):t._e()],1),a("div",[a("b-button",{staticClass:"upload_btn",attrs:{size:"sm",variant:"success"},on:{click:function(e){t.triggerUpload()}}},[a("i",{staticClass:"fa fa-plus-square "}),t._v(" 上传\n                    "),a("input",{staticClass:"upload",attrs:{id:"upload",type:"file",accept:t.acceptType},on:{change:t.add_source}})])],1)]),a("loading",{ref:"load"}),t.list.length>0?a("div",{staticClass:"tab_parent"},[0===t.tab_type?a("div",{staticClass:"images"},t._l(t.list,function(e,i){return a("div",{staticClass:"image_item"},[a("div",{staticClass:"image"},[a("b-img",{attrs:{center:"",src:e.url,alt:"Thumbnail"}})],1),a("div",{staticClass:"hover"},[a("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){t.deleteSource(i)}}},[a("i",{staticClass:"fa fa-trash-o"})]),t.group_list.length>0?a("b-dropdown",{attrs:{variant:"secondary",size:"sm","no-caret":""}},[a("template",{slot:"button-content"},[a("i",{staticClass:"fa fa-reorder"})]),a("b-dropdown-header",[t._v("移动到分组")]),t._l(t.group_list,function(n,o){return n._id!==e.group?a("b-dropdown-item",{key:o,on:{click:function(e){t.setSource(i,n._id)}}},[t._v(t._s(n.name))]):t._e()})],2):t._e()],1),t.is_components?a("p",[a("i",{staticClass:"fa fa-plus mr-2"}),a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.insert(i)}}},[t._v(t._s(e.originalname))])]):t._e(),t.is_components?t._e():a("p",[a("a",{attrs:{href:"javascript:void(0);"}},[t._v(t._s(e.originalname))])])])})):t._e(),1===t.tab_type?a("div",{staticClass:"medias"},t._l(t.list,function(e,i){return a("div",{key:i,staticClass:"media_item"},[a("div",{staticClass:"media"},[a("audio",{attrs:{src:e.url,controls:"controls",loop:"loop"}})]),a("div",{staticClass:"ctrl"},[a("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){t.deleteSource(i)}}},[a("i",{staticClass:"fa fa-trash-o"})]),t.is_components?a("p",[a("i",{staticClass:"fa fa-plus mr-2"}),a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.insert(i)}}},[t._v(t._s(e.originalname))])]):t._e(),t.is_components?t._e():a("p",[a("a",{attrs:{href:"javascript:void(0);"}},[t._v(t._s(e.originalname))])]),t.group_list.length>0?a("b-dropdown",{attrs:{variant:"secondary",size:"sm","no-caret":""}},[a("template",{slot:"button-content"},[a("i",{staticClass:"fa fa-reorder"})]),a("b-dropdown-header",[t._v("移动到分组")]),t._l(t.group_list,function(n,o){return n._id!==e.group?a("b-dropdown-item",{key:o,on:{click:function(e){t.setSource(i,n._id)}}},[t._v(t._s(n.name))]):t._e()})],2):t._e()],1)])})):t._e(),2===t.tab_type?a("div",{staticClass:"medias"},t._l(t.list,function(e,i){return a("div",{key:i,staticClass:"video_item"},[a("div",{staticClass:"video"},[a("video",{attrs:{src:e.url,controls:"controls",loop:"loop"}})]),a("div",{staticClass:"ctrl"},[a("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(e){t.deleteSource(i)}}},[a("i",{staticClass:"fa fa-trash-o"})]),t.is_components?a("p",[a("i",{staticClass:"fa fa-plus mr-2"}),a("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){t.insert(i)}}},[t._v(t._s(e.originalname))])]):t._e(),t.is_components?t._e():a("p",[a("a",{attrs:{href:"javascript:void(0);"}},[t._v(t._s(e.originalname))])]),t.group_list.length>0?a("b-dropdown",{attrs:{variant:"secondary",size:"sm","no-caret":""}},[a("template",{slot:"button-content"},[a("i",{staticClass:"fa fa-reorder"})]),a("b-dropdown-header",[t._v("移动到分组")]),t._l(t.group_list,function(n,o){return n._id!==e.group?a("b-dropdown-item",{key:o,on:{click:function(e){t.setSource(i,n._id)}}},[t._v(t._s(n.name))]):t._e()})],2):t._e()],1)])})):t._e(),a("b-pagination",{attrs:{align:"center",size:"sm","total-rows":t.totalNum,"per-page":t.perPage},on:{change:t.getList},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1):t._e(),0===t.list.length?a("div",{staticClass:"blanket"},[a("i",{staticClass:"fa fa-child"}),t._v("    没有素材\n        ")]):t._e()],1),a("b-modal",{ref:"modalForGroup",attrs:{id:"modalForGroup",size:"sm",title:"添加分组"},on:{ok:t.handleOk,shown:t.clearName}},[a("form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit(e)}}},[a("b-form-input",{attrs:{type:"text",size:"sm",placeholder:"请输入要添加的分组"},model:{value:t.temp_type,callback:function(e){t.temp_type=e},expression:"temp_type"}})],1)])],1)},[],!1,null,"02a66ec5",null);o.options.__file="source_tab.vue";e.a=o.exports},183:function(t,e,a){"use strict";var i=a(181);a.n(i).a},184:function(t,e,a){(t.exports=a(163)(!1)).push([t.i,".images[data-v-02a66ec5],.medias[data-v-02a66ec5]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-around}.image_item[data-v-02a66ec5]{width:150px}.image_item[data-v-02a66ec5],.media_item[data-v-02a66ec5]{border-radius:5px;font-size:12px;margin:.5rem 1rem;position:relative}.media_item[data-v-02a66ec5]{width:300px}.video_item[data-v-02a66ec5]{width:250px;border-radius:5px;font-size:12px;margin:.5rem 1rem;position:relative}.image_item .hover[data-v-02a66ec5],.video_item .hover[data-v-02a66ec5]{width:150px;height:150px;position:absolute;top:0;background:rgba(39,35,39,.48);color:#fff;display:none;justify-content:space-between;align-items:flex-start;padding:10px;font-size:20px}.image_item .hover i[data-v-02a66ec5],.video_item .hover i[data-v-02a66ec5]{cursor:pointer}.image_item:hover .hover[data-v-02a66ec5],.video_item:hover .hover[data-v-02a66ec5]{display:flex}.image_item p[data-v-02a66ec5]{width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin:.2rem 0 0;padding:5px;text-align:center;color:#fff;border-radius:.3rem;background:#f1f3f4}.media_item .ctrl[data-v-02a66ec5],.video_item .ctrl[data-v-02a66ec5]{width:300px;margin:.2rem 0 0;text-align:center;color:#fff;border-radius:.3rem;background:#f1f3f4;display:flex;flex-direction:row;padding:0;justify-content:space-between}.video_item .ctrl[data-v-02a66ec5]{width:250px}.media_item .ctrl>p[data-v-02a66ec5],.video_item .ctrl>p[data-v-02a66ec5]{width:230px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:34px;margin:0}.image_item p>.fa[data-v-02a66ec5],.media_item p>.fa[data-v-02a66ec5],.video_item p>.fa[data-v-02a66ec5]{color:#4e4e4e;display:none}.image_item p:hover>.fa[data-v-02a66ec5],.media_item p:hover>.fa[data-v-02a66ec5],.video_item p:hover>.fa[data-v-02a66ec5]{display:inline-block}.image[data-v-02a66ec5]{width:150px;height:150px;padding:5px;border-radius:5px;border:2px solid #b1b1b1;background:#fff}.media[data-v-02a66ec5]{margin-bottom:5px}.image img[data-v-02a66ec5]{max-height:100%;max-width:100%;margin:50%;box-sizing:border-box;transform:translateY(-50%)}.video[data-v-02a66ec5]{width:250px;height:250px;padding:5px;border-radius:5px;border:2px solid #b1b1b1;background:#12161b;overflow:hidden}.video video[data-v-02a66ec5]{max-height:100%;max-width:100%;margin:50%;box-sizing:border-box;transform:translateX(-50%) translateY(-50%)}.upload_btn[data-v-02a66ec5]{font-size:12px;overflow:hidden;text-align:center;margin:10px auto}.upload_btn input[type=file][data-v-02a66ec5]{position:absolute;display:none}.flex_space_between[data-v-02a66ec5]{justify-content:space-between}.dropdown-item[data-v-02a66ec5]{font-size:14px}.blanket[data-v-02a66ec5]{font-size:14px;line-height:250px;text-align:center;color:#ccc}",""])},206:function(t,e,a){var i=a(272);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(164).default)("57b8574f",i,!0,{})},271:function(t,e,a){"use strict";var i=a(206);a.n(i).a},272:function(t,e,a){(t.exports=a(163)(!1)).push([t.i,".bread_head[data-v-39390de8]{margin-bottom:0;border-radius:0}",""])},295:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(182),n=a(178),o={name:"index",components:{sourceTab:i.a,loading:n.a},data:function(){return{tabIndex:0,breadcrumb:[{text:"Source",href:"/admin/app/source/index"}],groupList:[],loading:!0}},methods:{changTab:function(t){this.tabIndex=t},update:function(t){console.log(t),this.groupList=t}},beforeMount:function(){var t=this;this.axios.get("/api/admin/source/type/list").then(function(e){t.groupList=e.data.data,t.loading=!1,t.$refs.loadGroup.finished()}).catch(function(e){return t.$eventHub.$emit("alert",{type:"warning",message:"获取分组列表出错!"})})}},s=(a(271),a(39)),r=Object(s.a)(o,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"main_container"},[a("b-breadcrumb",{staticClass:"bread_head",attrs:{items:t.breadcrumb}}),a("loading",{ref:"loadGroup"}),t.loading?t._e():a("b-card",{attrs:{"no-body":""}},[a("b-tabs",{attrs:{small:"",card:""},on:{input:t.changTab}},[a("b-tab",{staticClass:"bg-dark",attrs:{title:"图片",active:""}},[0===t.tabIndex?a("source-tab",{attrs:{tab_type:0,groupList:t.groupList},on:{update:t.update}}):t._e()],1),a("b-tab",{staticClass:"bg-dark",attrs:{title:"音频"}},[1===t.tabIndex?a("source-tab",{attrs:{tab_type:1,groupList:t.groupList},on:{update:t.update}}):t._e()],1),a("b-tab",{staticClass:"bg-dark",attrs:{title:"视频"}},[2===t.tabIndex?a("source-tab",{attrs:{tab_type:2,groupList:t.groupList},on:{update:t.update}}):t._e()],1)],1)],1)],1)])},[],!1,null,"39390de8",null);r.options.__file="index.vue";e.default=r.exports}});